<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý bán xôi</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5e8c9;
            color: #5a3e1f;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff9e6;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #d35400;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .add-customer-btn {
            background-color: #e67e22;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }
        
        .add-customer-btn:hover {
            background-color: #d35400;
        }
        
        .customer-form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: none;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .menu-item {
            background-color: #f9f1e0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .menu-item h3 {
            color: #e67e22;
            margin-top: 0;
        }
        
        .price {
            font-weight: bold;
            color: #d35400;
        }
        
        .options {
            margin-top: 10px;
        }
        
        .option-group {
            margin-bottom: 10px;
        }
        
        .option-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .toppings {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .topping {
            display: flex;
            align-items: center;
        }
        
        .topping input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }
        
        .quantity {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .quantity button {
            background-color: #e67e22;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .quantity input {
            width: 50px;
            text-align: center;
            margin: 0 10px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .save-btn, .cancel-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .save-btn {
            background-color: #27ae60;
            color: white;
        }
        
        .cancel-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .customer-list {
            margin-top: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid #ddd; /* Thêm viền cho ô */
        }
        
        th {
            background-color: #e67e22;
            color: white;
            text-align: center; /* Căn giữa tiêu đề */
        }
        
        tr:nth-child(even) {
            background-color: #f9f1e0;
        }
        
        tr:hover {
            background-color: #f5e8c9;
        }
        
        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .edit-btn {
            background-color: #3498db;
            color: white;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .summary {
            margin-top: 30px;
            background-color: #f9f1e0;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .summary-item {
            flex: 1;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: bold;
            color: #d35400;
        }
        
        .reset-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #7f8c8d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .notes {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .highlight {
            font-weight: bold;
            color: #d35400;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quản lý bán xôi</h1>
        
        <button id="addCustomerBtn" class="add-customer-btn">+ Thêm khách hàng</button>
        
        <div id="customerForm" class="customer-form">
            <div class="form-group">
                <label for="customerName">Tên khách hàng:</label>
                <input type="text" id="customerName" placeholder="Nhập tên khách hàng">
            </div>
            
            <div class="form-group">
                <label for="customerAddress">Địa chỉ:</label>
                <input type="text" id="customerAddress" placeholder="Nhập địa chỉ">
            </div>
            
            <div class="form-group">
                <label for="customerPhone">Số điện thoại:</label>
                <input type="text" id="customerPhone" placeholder="Nhập số điện thoại">
            </div>
            
            <div class="menu-item">
                <h3>Xôi thịt kho <span class="price">(25,000đ)</span></h3>
                <div class="quantity">
                    <button id="xoiThitKhoMinus">-</button>
                    <input type="number" id="xoiThitKhoQty" value="0" min="0">
                    <button id="xoiThitKhoPlus">+</button>
                </div>
                
                <div class="options">
                    <div class="option-group">
                        <div class="option-title">Chả:</div>
                        <select id="xoiThitKhoCha">
                            <option value="">Không chọn</option>
                            <option value="nhiều chả">Nhiều chả</option>
                            <option value="ít chả">Ít chả</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <div class="option-title">Đỗ:</div>
                        <select id="xoiThitKhoDo">
                            <option value="">Không chọn</option>
                            <option value="nhiều đỗ">Nhiều đỗ</option>
                            <option value="ít đỗ">Ít đỗ</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <div class="option-title">Hành:</div>
                        <select id="xoiThitKhoHanh">
                            <option value="">Không chọn</option>
                            <option value="nhiều hành">Nhiều hành</option>
                            <option value="ít hành">Ít hành</option>
                            <option value="không hành">Không hành</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <div class="option-title">Nước thịt:</div>
                        <select id="xoiThitKhoNuocThit">
                            <option value="">Không chọn</option>
                            <option value="nhiều nước thịt">Nhiều nước thịt</option>
                            <option value="ít nước thịt">Ít nước thịt</option>
                            <option value="không nước thịt">Không nước thịt</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <div class="option-title">Thêm topping:</div>
                        <div class="toppings">
                            <div class="topping">
                                <input type="checkbox" id="xoiThitKhoTrungOp" value="trứng ốp (+5,000đ)">
                                <label for="xoiThitKhoTrungOp">Trứng ốp (+5,000đ)</label>
                            </div>
                            <div class="topping">
                                <input type="checkbox" id="xoiThitKhoChaCa" value="chả cá (+10,000đ)">
                                <label for="xoiThitKhoChaCa">Chả cá (+10,000đ)</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="menu-item">
                <h3>Xôi ruốc <span class="price">(15,000đ)</span></h3>
                <div class="quantity">
                    <button id="xoiRuocMinus">-</button>
                    <input type="number" id="xoiRuocQty" value="0" min="0">
                    <button id="xoiRuocPlus">+</button>
                </div>
                
                <div class="options">
                    <div class="option-group">
                        <div class="option-title">Thêm topping:</div>
                        <div class="toppings">
                            <div class="topping">
                                <input type="checkbox" id="xoiRuocTrungOp" value="trứng ốp (+5,000đ)">
                                <label for="xoiRuocTrungOp">Trứng ốp (+5,000đ)</label>
                            </div>
                            <div class="topping">
                                <input type="checkbox" id="xoiRuocCha" value="chả (+10,000đ)">
                                <label for="xoiRuocCha">Chả (+10,000đ)</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button id="cancelBtn" class="cancel-btn">Hủy</button>
                <button id="saveBtn" class="save-btn">Lưu</button>
            </div>
        </div>
        
        <div class="customer-list">
            <h2>Danh sách khách hàng</h2>
            <table id="customerTable">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Tên khách hàng</th>
                        <th>Địa chỉ</th>
                        <th>SĐT</th>
                        <th>Đơn hàng</th>
                        <th>Tổng tiền</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="customerTableBody">
                    <!-- Danh sách khách hàng sẽ được thêm vào đây -->
                </tbody>
            </table>
        </div>
        
        <div class="summary">
            <div class="summary-item">
                <div>Tổng số khách hàng</div>
                <div class="summary-value" id="totalCustomers">0</div>
            </div>
            <div class="summary-item">
                <div>Tổng số suất xôi</div>
                <div class="summary-value" id="totalOrders">0</div>
            </div>
            <div class="summary-item">
                <div>Tổng doanh thu</div>
                <div class="summary-value" id="totalRevenue">0đ</div>
            </div>
        </div>
        
        <button id="resetBtn" class="reset-btn">Reset dữ liệu</button>
    </div>

    <script>
        // Biến lưu trữ danh sách khách hàng
        let customers = JSON.parse(localStorage.getItem('xoiCustomers')) || [];
        let editingIndex = -1;
        
        // DOM Elements
        const addCustomerBtn = document.getElementById('addCustomerBtn');
        const customerForm = document.getElementById('customerForm');
        const customerTableBody = document.getElementById('customerTableBody');
        const totalCustomersEl = document.getElementById('totalCustomers');
        const totalOrdersEl = document.getElementById('totalOrders');
        const totalRevenueEl = document.getElementById('totalRevenue');
        const resetBtn = document.getElementById('resetBtn');
        
        // Hiển thị form thêm khách hàng
        addCustomerBtn.addEventListener('click', () => {
            customerForm.style.display = 'block';
            resetForm();
            editingIndex = -1;
        });
        
        // Ẩn form khi click hủy
        document.getElementById('cancelBtn').addEventListener('click', () => {
            customerForm.style.display = 'none';
        });
        
        // Xử lý nút lưu
        document.getElementById('saveBtn').addEventListener('click', saveCustomer);
        
        // Xử lý nút reset
        resetBtn.addEventListener('click', resetData);
        
        // Xử lý tăng giảm số lượng
        setupQuantityButtons('xoiThitKho');
        setupQuantityButtons('xoiRuoc');
        
        // Hiển thị danh sách khách hàng ban đầu
        renderCustomerList();
        updateSummary();
        
        // Hàm thiết lập nút tăng giảm số lượng
        function setupQuantityButtons(prefix) {
            const minusBtn = document.getElementById(`${prefix}Minus`);
            const plusBtn = document.getElementById(`${prefix}Plus`);
            const qtyInput = document.getElementById(`${prefix}Qty`);
            
            minusBtn.addEventListener('click', () => {
                const currentValue = parseInt(qtyInput.value);
                if (currentValue > 0) {
                    qtyInput.value = currentValue - 1;
                }
            });
            
            plusBtn.addEventListener('click', () => {
                const currentValue = parseInt(qtyInput.value);
                qtyInput.value = currentValue + 1;
            });
        }
        
        // Hàm lưu khách hàng
        function saveCustomer() {
            const name = document.getElementById('customerName').value.trim();
            const address = document.getElementById('customerAddress').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            
            // Lấy thông tin xôi thịt kho
            const xoiThitKhoQty = parseInt(document.getElementById('xoiThitKhoQty').value);
            const xoiThitKhoCha = document.getElementById('xoiThitKhoCha').value;
            const xoiThitKhoDo = document.getElementById('xoiThitKhoDo').value;
            const xoiThitKhoHanh = document.getElementById('xoiThitKhoHanh').value;
            const xoiThitKhoNuocThit = document.getElementById('xoiThitKhoNuocThit').value;
            const xoiThitKhoTrungOp = document.getElementById('xoiThitKhoTrungOp').checked;
            const xoiThitKhoChaCa = document.getElementById('xoiThitKhoChaCa').checked;
            
            // Lấy thông tin xôi ruốc
            const xoiRuocQty = parseInt(document.getElementById('xoiRuocQty').value);
            const xoiRuocTrungOp = document.getElementById('xoiRuocTrungOp').checked;
            const xoiRuocCha = document.getElementById('xoiRuocCha').checked;
            
            // Kiểm tra xem có đơn hàng nào không
            if (xoiThitKhoQty === 0 && xoiRuocQty === 0) {
                alert('Vui lòng chọn ít nhất một món xôi!');
                return;
            }
            
            // Tạo ghi chú cho xôi thịt kho
            let xoiThitKhoNotes = [];
            if (xoiThitKhoQty > 0) {
                if (xoiThitKhoCha) xoiThitKhoNotes.push(xoiThitKhoCha);
                if (xoiThitKhoDo) xoiThitKhoNotes.push(xoiThitKhoDo);
                if (xoiThitKhoHanh) xoiThitKhoNotes.push(xoiThitKhoHanh);
                if (xoiThitKhoNuocThit) xoiThitKhoNotes.push(xoiThitKhoNuocThit);
                if (xoiThitKhoTrungOp) xoiThitKhoNotes.push('trứng ốp (+5,000đ)');
                if (xoiThitKhoChaCa) xoiThitKhoNotes.push('chả cá (+10,000đ)');
            }
            
            // Tạo ghi chú cho xôi ruốc
            let xoiRuocNotes = [];
            if (xoiRuocQty > 0) {
                if (xoiRuocTrungOp) xoiRuocNotes.push('trứng ốp (+5,000đ)');
                if (xoiRuocCha) xoiRuocNotes.push('chả (+10,000đ)');
            }
            
            // Tính tổng tiền
            let total = 0;
            
            // Tính tiền xôi thịt kho
            let xoiThitKhoTotal = 0;
            if (xoiThitKhoQty > 0) {
                xoiThitKhoTotal = xoiThitKhoQty * 25000;
                if (xoiThitKhoTrungOp) xoiThitKhoTotal += xoiThitKhoQty * 5000;
                if (xoiThitKhoChaCa) xoiThitKhoTotal += xoiThitKhoQty * 10000;
            }
            
            // Tính tiền xôi ruốc
            let xoiRuocTotal = 0;
            if (xoiRuocQty > 0) {
                xoiRuocTotal = xoiRuocQty * 15000;
                if (xoiRuocTrungOp) xoiRuocTotal += xoiRuocQty * 5000;
                if (xoiRuocCha) xoiRuocTotal += xoiRuocQty * 10000;
            }
            
            total = xoiThitKhoTotal + xoiRuocTotal;
            
            // Tạo đối tượng khách hàng
            const customer = {
                name,
                address,
                phone,
                orders: [],
                total
            };
            
            if (xoiThitKhoQty > 0) {
                customer.orders.push({
                    name: 'Xôi thịt kho',
                    quantity: xoiThitKhoQty,
                    price: 25000,
                    notes: xoiThitKhoNotes,
                    total: xoiThitKhoTotal
                });
            }
            
            if (xoiRuocQty > 0) {
                customer.orders.push({
                    name: 'Xôi ruốc',
                    quantity: xoiRuocQty,
                    price: 15000,
                    notes: xoiRuocNotes,
                    total: xoiRuocTotal
                });
            }
            
            // Thêm hoặc cập nhật khách hàng
            if (editingIndex === -1) {
                customers.push(customer);
            } else {
                customers[editingIndex] = customer;
            }
            
            // Lưu vào localStorage
            localStorage.setItem('xoiCustomers', JSON.stringify(customers));
            
            // Cập nhật giao diện
            renderCustomerList();
            updateSummary();
            
            // Ẩn form và reset
            customerForm.style.display = 'none';
            resetForm();
        }
        
        // Hàm hiển thị danh sách khách hàng
        function renderCustomerList() {
            customerTableBody.innerHTML = '';
            
            if (customers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="7" style="text-align: center;">Chưa có khách hàng nào</td>`;
                customerTableBody.appendChild(row);
                return;
            }
            
            customers.forEach((customer, index) => {
                const row = document.createElement('tr');
                
                // Hiển thị thông tin cơ bản
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${customer.name || '-'}</td>
                    <td>${customer.address || '-'}</td>
                    <td>${customer.phone || '-'}</td>
                `;
                
                // Hiển thị đơn hàng
                const ordersCell = document.createElement('td');
                customer.orders.forEach(order => {
                    const orderDiv = document.createElement('div');
                    orderDiv.innerHTML = `
                        <div><span class="highlight">${order.name}</span> x ${order.quantity}</div>
                        ${order.notes.length > 0 ? `<div class="notes">(${order.notes.join(', ')})</div>` : ''}
                    `;
                    ordersCell.appendChild(orderDiv);
                });
                row.appendChild(ordersCell);
                
                // Hiển thị tổng tiền
                const totalCell = document.createElement('td');
                totalCell.textContent = `${customer.total.toLocaleString()}đ`;
                row.appendChild(totalCell);
                
                // Thêm nút sửa/xóa
                const actionsCell = document.createElement('td');
                actionsCell.innerHTML = `
                    <button class="action-btn edit-btn" data-index="${index}">Sửa</button>
                    <button class="action-btn delete-btn" data-index="${index}">Xóa</button>
                `;
                row.appendChild(actionsCell);
                
                customerTableBody.appendChild(row);
            });
            
            // Thêm sự kiện cho nút sửa/xóa
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    editCustomer(parseInt(e.target.getAttribute('data-index')));
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    deleteCustomer(parseInt(e.target.getAttribute('data-index')));
                });
            });
        }
        
        // Hàm sửa khách hàng
        function editCustomer(index) {
            editingIndex = index;
            const customer = customers[index];
            
            // Điền thông tin cơ bản
            document.getElementById('customerName').value = customer.name || '';
            document.getElementById('customerAddress').value = customer.address || '';
            document.getElementById('customerPhone').value = customer.phone || '';
            
            // Reset số lượng
            document.getElementById('xoiThitKhoQty').value = 0;
            document.getElementById('xoiRuocQty').value = 0;
            
            // Reset các lựa chọn
            resetOptions('xoiThitKho');
            resetOptions('xoiRuoc');
            
            // Điền thông tin đơn hàng
            customer.orders.forEach(order => {
                if (order.name === 'Xôi thịt kho') {
                    document.getElementById('xoiThitKhoQty').value = order.quantity;
                    
                    order.notes.forEach(note => {
                        if (note.includes('chả')) {
                            if (note.includes('nhiều')) {
                                document.getElementById('xoiThitKhoCha').value = 'nhiều chả';
                            } else {
                                document.getElementById('xoiThitKhoCha').value = 'ít chả';
                            }
                        } else if (note.includes('đỗ')) {
                            if (note.includes('nhiều')) {
                                document.getElementById('xoiThitKhoDo').value = 'nhiều đỗ';
                            } else {
                                document.getElementById('xoiThitKhoDo').value = 'ít đỗ';
                            }
                        } else if (note.includes('hành')) {
                            if (note.includes('nhiều')) {
                                document.getElementById('xoiThitKhoHanh').value = 'nhiều hành';
                            } else if (note.includes('ít')) {
                                document.getElementById('xoiThitKhoHanh').value = 'ít hành';
                            } else {
                                document.getElementById('xoiThitKhoHanh').value = 'không hành';
                            }
                        } else if (note.includes('nước thịt')) {
                            if (note.includes('nhiều')) {
                                document.getElementById('xoiThitKhoNuocThit').value = 'nhiều nước thịt';
                            } else if (note.includes('ít')) {
                                document.getElementById('xoiThitKhoNuocThit').value = 'ít nước thịt';
                            } else {
                                document.getElementById('xoiThitKhoNuocThit').value = 'không nước thịt';
                            }
                        } else if (note.includes('trứng ốp')) {
                            document.getElementById('xoiThitKhoTrungOp').checked = true;
                        } else if (note.includes('chả cá')) {
                            document.getElementById('xoiThitKhoChaCa').checked = true;
                        }
                    });
                } else if (order.name === 'Xôi ruốc') {
                    document.getElementById('xoiRuocQty').value = order.quantity;
                    
                    order.notes.forEach(note => {
                        if (note.includes('trứng ốp')) {
                            document.getElementById('xoiRuocTrungOp').checked = true;
                        } else if (note.includes('chả')) {
                            document.getElementById('xoiRuocCha').checked = true;
                        }
                    });
                }
            });
            
            // Hiển thị form
            customerForm.style.display = 'block';
        }
        
        // Hàm xóa khách hàng
        function deleteCustomer(index) {
            if (confirm('Bạn có chắc chắn muốn xóa khách hàng này?')) {
                customers.splice(index, 1);
                localStorage.setItem('xoiCustomers', JSON.stringify(customers));
                renderCustomerList();
                updateSummary();
            }
        }
        
        // Hàm cập nhật tổng kết
        function updateSummary() {
            const totalCustomers = customers.length;
            let totalOrders = 0;
            let totalRevenue = 0;
            
            customers.forEach(customer => {
                customer.orders.forEach(order => {
                    totalOrders += order.quantity;
                });
                totalRevenue += customer.total;
            });
            
            totalCustomersEl.textContent = totalCustomers;
            totalOrdersEl.textContent = totalOrders;
            totalRevenueEl.textContent = `${totalRevenue.toLocaleString()}đ`;
        }
        
        // Hàm reset form
        function resetForm() {
            document.getElementById('customerName').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('xoiThitKhoQty').value = 0;
            document.getElementById('xoiRuocQty').value = 0;
            
            resetOptions('xoiThitKho');
            resetOptions('xoiRuoc');
        }
        
        // Hàm reset các lựa chọn
        function resetOptions(prefix) {
            if (prefix === 'xoiThitKho') {
                document.getElementById('xoiThitKhoCha').value = '';
                document.getElementById('xoiThitKhoDo').value = '';
                document.getElementById('xoiThitKhoHanh').value = '';
                document.getElementById('xoiThitKhoNuocThit').value = '';
                document.getElementById('xoiThitKhoTrungOp').checked = false;
                document.getElementById('xoiThitKhoChaCa').checked = false;
            } else if (prefix === 'xoiRuoc') {
                document.getElementById('xoiRuocTrungOp').checked = false;
                document.getElementById('xoiRuocCha').checked = false;
            }
        }
        
        // Hàm reset toàn bộ dữ liệu
        function resetData() {
            if (confirm('Bạn có chắc chắn muốn xóa toàn bộ dữ liệu? Hành động này không thể hoàn tác.')) {
                customers = [];
                localStorage.removeItem('xoiCustomers');
                renderCustomerList();
                updateSummary();
            }
        }

        // Hàm viết hoa chữ cái đầu
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Cập nhật sự kiện khi người dùng điền thông tin
        document.getElementById('customerName').addEventListener('input', function() {
            this.value = capitalizeFirstLetter(this.value);
        });

        document.getElementById('customerAddress').addEventListener('input', function() {
            this.value = capitalizeFirstLetter(this.value);
        });
    </script>
</body>
</html>
